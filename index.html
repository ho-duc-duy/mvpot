<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MV Suggestion Tool</title>
    <style>
        /* Basic Reset & Defaults */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa; /* Lighter background */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        main {
            flex-grow: 1; /* Pushes footer elements down */
            padding-top: 80px; /* Increased padding for taller nav */
            width: 100%;
        }

        /* Navigation */
        .main-nav {
            background-color: rgba(51, 51, 51, 0.9); /* Slightly transparent dark */
            backdrop-filter: blur(5px); /* Blur effect for nav background */
            color: #fff;
            position: fixed; /* Keeps nav on top */
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between; /* Space between logo and menu */
            align-items: center;
            padding: 10px 25px; /* Padding around nav */
            height: 70px; /* Fixed height */
        }

        .logo-placeholder {
            /* Style for your <img> tag */
            max-width: 120px; /* Limit logo width */
            max-height: 50px; /* Limit logo height */
            object-fit: contain; /* Keep aspect ratio */
            user-select: none;
        }


        .main-nav ul {
            list-style: none;
            display: flex;
            align-items: center; /* Align items vertically */
            justify-content: flex-end; /* Align menu items to the right */
        }

        .main-nav ul li {
            margin-left: 30px; /* Increased space between menu items */
        }

        .main-nav ul li a {
            color: #fff;
            text-decoration: none;
            padding: 8px 12px; /* Slightly larger padding */
            font-size: 1.05em;
            border-radius: 4px;
            transition: color 0.3s ease, background-color 0.3s ease, border-bottom 0.3s ease;
            border-bottom: 3px solid transparent; /* Thicker underline */
            cursor: pointer; /* Ensure pointer cursor */
        }

        .main-nav ul li a:hover,
        .main-nav ul li a.active {
            color: #e0cff0; /* Lighter highlight */
            border-bottom: 3px solid #9E69AF; /* Use theme color */
            background-color: rgba(255, 255, 255, 0.1); /* Subtle background on hover/active */
        }

        /* Page Sections */
        .page {
            display: none; /* Hide pages by default */
            padding: 30px 20px; /* Increased padding */
            animation: fadeIn 0.6s ease-in-out;
            min-height: calc(100vh - 110px); /* Adjust based on nav/footer height */
            position: relative; /* Needed for absolute positioning of back button */
            padding-bottom: 80px; /* More space for the back button */
        }

        .page.active {
            display: block; /* Show active page */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-container {
            max-width: 950px; /* Slightly wider */
            margin: 20px auto;
            background-color: #fff;
            padding: 40px; /* More padding */
            border-radius: 10px; /* Softer corners */
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); /* Softer shadow */
        }

        /* Headings */
        h1, h2 {
            color: #343a40; /* Darker heading color */
            margin-bottom: 20px; /* More space below heading */
            font-weight: 600;
        }

        h1 {
            text-align: center;
            font-size: 2.4em;
            color: #495057;
        }

        h2 {
            font-size: 1.9em;
            border-bottom: 2px solid #eee; /* Slightly thicker border */
            padding-bottom: 8px;
            margin-top: 35px; /* More space between sections in results */
            color: #6E91D6; /* Use theme color */
        }
        .result-section h2 {
             color: #9E69AF; /* Other theme color for result headers */
             border-color: #e0d1e6;
        }


        /* Button General Styling & Gradient */
        .btn {
            display: inline-block;
            padding: 14px 28px; /* Larger padding */
            margin: 10px 8px;
            border: none;
            border-radius: 6px; /* Slightly rounder */
            cursor: pointer;
            font-size: 1.05em; /* Slightly larger font */
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            color: #fff; /* White text */
            background: linear-gradient(135deg, #9E69AF, #6E91D6); /* Gradient */
            background-size: 200% 200%; /* For hover animation */
            transition: background-position 0.4s ease-out, transform 0.15s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }

        /* Button Hover Animation */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .btn:hover {
            animation: gradientShift 4s ease infinite; /* Infinite gradient shift on hover */
            transform: translateY(-2px); /* Slight lift */
            box-shadow: 0 4px 10px rgba(138, 105, 175, 0.4); /* Colored shadow */
        }

        .btn:active {
            transform: scale(0.97) translateY(0); /* Press effect */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* Specific Button Styles */
         .btn-primary { /* Explore Now & Get Suggestions */
            /* Uses default gradient */
         }
         .btn-secondary { /* Go Back */
             background: linear-gradient(135deg, #6c757d, #495057); /* Grey gradient */
             background-size: 200% 200%;
         }
          .btn-secondary:hover {
             box-shadow: 0 4px 10px rgba(80, 80, 80, 0.3); /* Grey shadow */
         }

         .btn-warning { /* Record */
             background: linear-gradient(135deg, #ffc107, #ff9800); /* Yellow/Orange gradient */
             background-size: 200% 200%;
             color: #333; /* Dark text for yellow */
         }
         .btn-warning:hover {
             box-shadow: 0 4px 10px rgba(255, 170, 0, 0.4);
             color: #111;
         }

         .btn-danger { /* Stop Recording */
             background: linear-gradient(135deg, #dc3545, #c82333); /* Red gradient */
             background-size: 200% 200%;
         }
         .btn-danger:hover {
              box-shadow: 0 4px 10px rgba(220, 50, 70, 0.4);
         }


        .btn-back {
            position: absolute;
            bottom: 20px; /* Lower position */
            left: 25px; /* More inset */
            margin: 0;
            z-index: 10; /* Ensure it's above other content if needed */
        }

        #home-page .btn-back {
            display: none; /* Hide back button on home */
        }


        /* Home Page Specific */
        .hero-container {
            position: relative;
            width: 100%;
            height: 65vh; /* Use viewport height */
            min-height: 450px;
            max-height: 700px;
            overflow: hidden;
            border-radius: 10px; /* Match content container */
            margin: 0 auto 30px auto; /* Center and add margin below */
        }

        .hero-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            filter: blur(4px) brightness(0.9); /* Add blur and slight darken */
            transform: scale(1.05); /* Slightly zoom in to hide blurred edges */
        }

        .hero-text-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            background-color: rgba(0, 0, 0, 0.5); /* Darker overlay for contrast */
            padding: 40px 50px; /* More padding */
            border-radius: 8px;
            text-align: center;
            max-width: 85%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .hero-text-overlay h1 {
            font-size: 2.8em; /* Larger text */
            margin-bottom: 25px;
            color: #fff;
            border: none;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5); /* Text shadow */
        }

        /* About Page Specific */
        #about-page p {
            max-width: 750px; /* Wider paragraph */
            margin: 30px auto; /* Center paragraph */
            text-align: justify;
            font-size: 1.1em; /* Slightly larger text */
            color: #495057;
        }

        /* Feature Page Specific */
        #feature-form {
            margin-top: 30px;
        }

        .form-group {
            margin-bottom: 30px; /* More space between form groups */
        }

        .form-group label {
            display: block;
            margin-bottom: 10px; /* More space below label */
            font-weight: 600; /* Bolder label */
            color: #495057;
            font-size: 1.05em;
        }

        .form-group input[type="text"],
        .form-group textarea,
        .form-group select,
        .form-group input[type="file"] {
            width: 100%;
            padding: 14px; /* More padding */
            border: 1px solid #ced4da; /* Standard border */
            border-radius: 6px; /* Match button radius */
            font-size: 1em;
            margin-bottom: 5px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
             border-color: #8a6fb5; /* Theme color focus */
             box-shadow: 0 0 0 3px rgba(158, 105, 175, 0.2); /* Focus ring */
             outline: none;
        }


        .form-group textarea {
            resize: vertical;
            min-height: 120px; /* Taller textarea */
        }

         .form-group select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%236c757d" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 45px; /* Space for arrow */
            cursor: pointer;
         }
         .form-group select option[disabled] {
            color: #999;
         }

        /* Audio Input Group Styling */
        .audio-input-group {
            display: flex;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 10px; /* Space between elements */
        }

        .form-group input[type="file"] {
             padding: 8px 12px; /* Adjust padding for file input */
             cursor: pointer;
             flex-grow: 1; /* Allow file input to take space */
             min-width: 200px; /* Minimum width */
             margin-bottom: 0; /* Remove bottom margin if in group */
        }

        input[type="file"]::file-selector-button {
            padding: 10px 18px;
            margin-right: 12px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(135deg, #6c757d, #495057); /* Match secondary button */
            color: #fff;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.1s ease;
            font-weight: 600;
        }
        input[type="file"]::file-selector-button:hover {
            transform: scale(1.03);
        }
         input[type="file"]::file-selector-button:active {
            transform: scale(0.98);
         }

        /* Style for the (Optional) notice */
        .optional-notice {
            margin-left: 5px; /* Space after the button */
            font-size: 0.9em;
            color: #6c757d; /* Grey text */
            font-style: italic;
            vertical-align: middle; /* Align with button center */
        }

        #record-status {
            margin-left: 15px;
            font-style: italic;
            /* color is set dynamically via JS */
            font-weight: 500;
            display: inline-flex; /* Use flex to align animation and text */
            align-items: center; /* Vertically center items */
            min-height: 24px; /* Ensure space even when empty */
        }
        /* Specific status colors (applied via JS to #record-status) */
        #record-status.recording { color: #dc3545; }
        #record-status.transcribing { color: #007bff; } /* Can be used if desired */
        #record-status.complete { color: #28a745; }
        #record-status.error { color: #dc3545; }


        /* NEW: Recording Animation Styles */
        .recording-dots {
            display: inline-block; /* Initially hidden via inline style */
            vertical-align: middle;
            margin-right: 6px; /* Space between dots and status text */
        }

        .recording-dots span {
            display: inline-block;
            width: 8px;
            height: 8px;
            margin-left: 3px;
            border-radius: 50%;
            background-color: #dc3545; /* Red color for recording */
            animation: blink 1.4s infinite both; /* Apply animation */
        }

        /* Stagger the animation for each dot */
        .recording-dots span:nth-child(1) {
            animation-delay: 0s;
        }
        .recording-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .recording-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Keyframes for the blinking effect */
        @keyframes blink {
            0%, 80%, 100% {
                opacity: 0;
            }
            40% {
                opacity: 1;
            }
        }

         /* Style for transcript output area */
        #transcript-group {
            display: none; /* Hidden by default */
            margin-top: 20px; /* Space above the transcript box */
        }
        #transcript-output {
            background-color: #e9ecef; /* Slightly different background */
            font-style: italic;
            color: #495057;
            min-height: 80px; /* Smaller height */
            cursor: default; /* Indicate it's read-only */
        }


        .form-group small {
            display: block;
            margin-top: 8px;
            color: #6c757d; /* Grey text */
            font-size: 0.9em;
        }

        #get-suggestions-button {
            display: block;
            width: 100%;
            max-width: 350px; /* Wider button */
            margin: 40px auto 0 auto; /* More margin top, center */
            padding: 16px 30px; /* Even larger */
            font-size: 1.15em;
        }


        /* Results Area */
        #results-area {
            margin-top: 50px; /* More space before results */
            padding-top: 30px;
            border-top: 2px solid #eee; /* Thicker separator */
            display: none; /* Hide initially */
        }

        .result-section {
            background-color: #ffffff; /* White background for sections */
            padding: 25px 30px; /* More padding */
            margin-bottom: 25px;
            border-radius: 8px; /* Match content container */
            border: 1px solid #e9ecef; /* Lighter border */
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); /* Subtle shadow */
            display: none; /* Hide individual sections initially */
        }

        .result-section .content {
            white-space: pre-wrap;
            font-size: 1em; /* Standard font size */
            color: #495057; /* Slightly darker text */
            line-height: 1.7; /* More line spacing */
        }
        /* Style bullet points within results */
        .result-section .content ul,
        .result-section .content ol {
            margin-left: 25px; /* Indent lists */
            margin-top: 10px;
            margin-bottom: 10px;
            padding-left: 0; /* Remove default padding if using custom bullets */
            list-style: none; /* Remove default bullets */
        }
         .result-section .content li {
             margin-bottom: 8px; /* Space between list items */
             position: relative; /* Needed for custom bullet positioning */
             padding-left: 20px; /* Space for custom bullet */
         }
         /* Custom bullet point styling */
        .result-section .content li::before {
            content: '•'; /* Bullet character */
            color: #9E69AF; /* Theme color for bullet */
            font-weight: bold;
            display: inline-block;
            position: absolute;
            left: 0;
            top: 0; /* Adjust vertical alignment if needed */
            width: 20px; /* Width of the bullet area */
        }
        /* Apply custom bullet styling within the text-only areas */
        #result-concept .content,
        #result-requirements .content,
        #result-budget .content {
             white-space: normal; /* Allow wrapping */
        }
        #result-requirements ul, #result-budget ul {
            list-style: none;
            padding-left: 0;
        }
        #result-requirements li, #result-budget li {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
        }
        #result-requirements li::before, #result-budget li::before {
            content: '▹'; /* Use a different bullet for lists */
            color: #6E91D6; /* Another theme color */
            font-size: 1.2em;
            position: absolute;
            left: 0;
            top: -2px; /* Adjust position */
        }


        /* Image Placeholder Styles */
        .image-placeholder-container {
            display: grid; /* Use grid for better alignment */
            gap: 20px; /* Space between image placeholders */
            margin-top: 15px;
        }

        /* Grid layout for placeholders */
        #result-visuals .image-placeholder-container {
             grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Responsive grid */
        }
        #result-moodboard .image-placeholder-container {
             grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Responsive grid */
        }

        .image-placeholder {
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background-color: #f8f9fa;
            overflow: hidden;
            text-align: center;
            color: #495057;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .image-placeholder:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }

        .image-placeholder img {
            display: block;
            width: 100%;
            height: 180px;
            object-fit: cover;
            background-color: #e9ecef;
            border-bottom: 1px solid #dee2e6;
        }
        #result-moodboard .image-placeholder img {
             height: 140px;
         }

        .image-placeholder figcaption {
            font-size: 0.9em;
            padding: 10px 12px;
            background-color: #fff;
            min-height: 50px;
            line-height: 1.4;
        }

        /* Specific Small Notes */
        .result-section small {
            display: block;
            margin-top: 15px;
            color: #6c757d;
            font-style: italic;
            font-size: 0.85em;
        }

        /* Color Palette Display */
        .color-palette-display {
            display: flex;
            flex-wrap: wrap;
            gap: 15px; /* More space */
            margin-top: 15px;
        }
        .color-swatch {
            min-width: 110px;
            height: 80px;
            border-radius: 6px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: 600;
            text-align: center;
            overflow: hidden;
            padding: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
            flex-grow: 1;
        }
        .color-swatch:hover {
            transform: scale(1.05);
        }

        .color-swatch span {
            display: block;
            word-break: break-word;
            max-width: 100%;
        }
        .color-swatch .hex-code {
            margin-top: 8px;
            font-size: 1em;
            font-family: 'Courier New', Courier, monospace;
            user-select: all;
            opacity: 0.85;
        }


        /* Loading Spinner */
        #loading-indicator p {
            font-weight: 500;
            color: #495057;
        }
        .spinner {
            border: 5px solid rgba(0, 0, 0, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border-left-color: #6E91D6;
            margin: 15px auto;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error Message */
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 18px 25px;
            border-radius: 6px;
            margin: 25px 0;
            text-align: center;
            font-weight: 500;
            display: none; /* Hidden by default */
        }

        /* Responsive Adjustments */
        @media (max-width: 992px) {
             .content-container { max-width: 90%; padding: 30px; }
             h1 { font-size: 2.1em; }
             h2 { font-size: 1.7em; }
             .hero-text-overlay h1 { font-size: 2.4em; }
             #result-visuals .image-placeholder-container { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
             #result-moodboard .image-placeholder-container { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
        }


        @media (max-width: 768px) {
            .main-nav {
                padding: 10px 15px;
                height: auto; /* Allow wrap */
                flex-direction: column;
                align-items: flex-start;
            }
            .logo-placeholder { margin-bottom: 10px; width: 80px; height: 40px; font-size: 1em; }
            .main-nav ul {
                justify-content: flex-start;
                width: 100%;
                padding-top: 10px;
                flex-wrap: wrap;
            }
             .main-nav ul li { margin-left: 0; margin-right: 15px; margin-bottom: 5px; }
             .main-nav ul li a { padding: 6px 10px; font-size: 1em; }
            main { padding-top: 140px; }

            .hero-container { height: 55vh; min-height: 400px; }
            .hero-text-overlay { padding: 30px; }
            .hero-text-overlay h1 { font-size: 2em; }

            h1 { font-size: 1.9em; }
            h2 { font-size: 1.6em; }
            .content-container { padding: 25px; }

            #result-visuals .image-placeholder-container { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
            #result-moodboard .image-placeholder-container { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
            .image-placeholder img { height: 150px; }
             #result-moodboard .image-placeholder img { height: 120px; }


            .btn-back {
               position: relative;
               bottom: auto;
               left: auto;
               margin: 30px auto 0 auto;
               display: block;
               width: fit-content;
            }
             #home-page .btn-back { display: none; }
            .page { padding-bottom: 30px; padding-left: 15px; padding-right: 15px; }
        }

        @media (max-width: 480px) {
            main { padding-top: 130px; }
            .hero-container { height: 50vh; min-height: 350px; }
            .hero-text-overlay { padding: 25px; max-width: 90%; }
            .hero-text-overlay h1 { font-size: 1.7em; }

            .btn { padding: 12px 22px; font-size: 1em; margin: 8px 5px;}
            #get-suggestions-button { max-width: 90%; padding: 14px 25px; font-size: 1.1em; }

            .form-group input[type="text"],
            .form-group textarea,
            .form-group select { padding: 12px; }

             /* Stack audio buttons vertically */
            .audio-input-group { flex-direction: column; align-items: stretch; }
            .form-group input[type="file"] { margin-bottom: 10px; }
             .audio-input-group .btn { width: 100%; margin: 5px 0;} /* Full width audio buttons */
             #record-status { margin: 5px 0 10px 0; text-align: center; }


            #result-visuals .image-placeholder-container { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); } /* Maybe 1 or 2 wide */
            #result-moodboard .image-placeholder-container { grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); } /* 2 or 3 wide */
            .image-placeholder img { height: 140px; }
             #result-moodboard .image-placeholder img { height: 110px; }

            .content-container { padding: 20px; }
             .result-section { padding: 20px; }
             h1 { font-size: 1.7em; }
             h2 { font-size: 1.5em; }

            /* Responsive adjustments for optional notice and status */
            .optional-notice {
                 margin-left: 0;
                 margin-top: 5px;
                 display: block;
                 text-align: center;
            }
            #record-status {
                  margin-left: 0;
                  justify-content: center;
                  width: 100%;
                  margin-top: 5px;
            }
        }

    </style>
</head>
<body>

    <nav class="main-nav">
        <img src="logofinal(white).png" alt="MV Assistant Logo" class="logo-placeholder">
        <ul>
            <li><a data-page="home" class="nav-link active">Home</a></li>
            <li><a data-page="about" class="nav-link">About</a></li>
            <li><a data-page="feature" class="nav-link">Feature</a></li>
        </ul>
    </nav>

    <main>
        <!-- Home Page Section -->
        <section id="home-page" class="page active">
            <div class="hero-container">
                <img src="heroimg.jpg" alt="Abstract music visuals" class="hero-image">
                <div class="hero-text-overlay">
                    <h1>Get your MV suggestion based on your lyrics!</h1>
                    <button id="explore-button" class="btn btn-primary">Explore now</button>
                </div>
            </div>
            <button class="btn btn-secondary btn-back" data-target="home">Go Back (to Home)</button>
        </section>

        <!-- About Page Section -->
        <section id="about-page" class="page">
            <div class="content-container">
                <h2>About Us</h2>
                <p>
                    Welcome to the MV Assistant! We are passionate about helping artists translate their musical creations into compelling visual stories. Crafting the perfect music video concept can be challenging, requiring a blend of artistic vision and practical planning. Our AI-powered tool is designed to bridge that gap. By analyzing your lyrics, keywords, and genre, MV Assistant generates tailored suggestions for music video concepts, requirements, budget estimations, visual inspirations, and color palettes. We aim to streamline the creative process, providing a launchpad for your ideas and empowering you to bring your music to life visually, whether you're an indie artist or part of a larger production. Let's make something amazing together!
                </p>
            </div>
            <button class="btn btn-secondary btn-back" data-target="home">Go Back</button>
        </section>

        <!-- Feature Page Section -->
        <section id="feature-page" class="page">
            <div class="content-container">
                <h1>MV Assistant</h1>

                <form id="feature-form" onsubmit="return false;">
                    <div class="form-group">
                        <label for="lyrics-input">Music Lyrics:</label>
                        <textarea id="lyrics-input" rows="7" placeholder="Paste your complete song lyrics here..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="keywords-input">Keywords / Theme:</label>
                        <input type="text" id="keywords-input" placeholder="e.g., nostalgic, summer vibe, urban decay, overcoming struggle, first love">
                    </div>

                    <div class="form-group">
                        <label for="genre-select">Music Genre:</label>
                        <select id="genre-select" required>
                            <option value="" disabled selected>-- Select a Genre --</option>
                            <option value="RnB">RnB / Soul</option>
                            <option value="Folk">Folk / Acoustic</option>
                            <option value="Rock">Rock (Alternative, Hard Rock, etc.)</option>
                            <option value="Pop">Pop (Synth-pop, Dance-pop, etc.)</option>
                            <option value="Hiphop">Hip-hop / Rap</option>
                            <option value="Electronic">Electronic (EDM, House, Techno)</option>
                            <option value="Classical">Classical / Orchestral</option>
                            <option value="Country">Country</option>
                             <option value="Jazz">Jazz / Blues</option>
                             <option value="Reggae">Reggae / Dancehall</option>
                             <option value="Metal">Metal</option>
                            <option value="Other">Other / Fusion</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="track-upload">Track Input (Optional):</label>
                        <div class="audio-input-group">
                             <input type="file" id="track-upload" accept="audio/*">
                             <button type="button" id="record-audio-button" class="btn btn-warning">Record Audio</button>
                             <span class="optional-notice">(Optional)</span>
                             <span id="record-status">
                                 <span id="recording-animation" class="recording-dots" style="display: none;"><span>.</span><span>.</span><span>.</span></span>
                                 <span id="record-status-text"></span>
                             </span>
                        </div>
                        <small>Note: Audio analysis (upload/record) requires browser support for recording & speech recognition. Suggestions are primarily based on text inputs + transcript.</small>
                    </div>

                    <div class="form-group" id="transcript-group" style="display: none;">
                        <label for="transcript-output">Singing Transcript (from recording):</label>
                        <textarea id="transcript-output" rows="4" readonly placeholder="Transcript will appear here after recording..."></textarea>
                        <small>This text will be analyzed along with lyrics.</small>
                    </div>

                    <button type="button" id="get-suggestions-button" class="btn btn-primary">Get Suggestions!</button>
                </form>

                <div id="loading-indicator" style="display: none; margin-top: 30px; text-align: center;">
                    <p>Generating creative suggestions... This might take a few moments.</p>
                    <div class="spinner"></div>
                </div>

                <div id="error-message" class="error-message"></div>

                <div id="results-area">
                     <section id="result-concept" class="result-section"><h2>Concept / Key Visual</h2><div class="content"></div></section>
                     <section id="result-requirements" class="result-section"><h2>Requirements for MV</h2><div class="content"><ul></ul></div></section> <!-- Ensure list exists for bullets -->
                     <section id="result-budget" class="result-section"><h2>Estimated Budget</h2><div class="content"><ul></ul></div></section> <!-- Ensure list exists for bullets -->
                     <section id="result-visuals" class="result-section">
                         <h2>Visual Demo (Key Image Ideas)</h2>
                         <div class="content image-placeholder-container"></div>
                         <small>Note: Images are illustrative placeholders generated based on AI descriptions.</small>
                     </section>
                     <section id="result-moodboard" class="result-section">
                         <h2>Moodboard Influences</h2>
                          <div class="content">
                              <p id="moodboard-description"></p>
                              <div class="image-placeholder-container" id="moodboard-images"></div>
                         </div>
                          <small>Note: Images are illustrative placeholders generated based on AI descriptions.</small>
                     </section>
                     <section id="result-palette" class="result-section">
                         <h2>Color Palette</h2>
                         <div class="content color-palette-display"></div>
                     </section>
                </div>

            </div>
             <button class="btn btn-secondary btn-back" data-target="home">Go Back</button>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element References ---
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page');
            const exploreButton = document.getElementById('explore-button');
            const backButtons = document.querySelectorAll('.btn-back');
            const getSuggestionsButton = document.getElementById('get-suggestions-button');
            const featureForm = document.getElementById('feature-form');
            const resultsArea = document.getElementById('results-area');
            const loadingIndicator = document.getElementById('loading-indicator');
            const errorMessageDiv = document.getElementById('error-message');
            const recordAudioButton = document.getElementById('record-audio-button');
            const recordStatus = document.getElementById('record-status');
            const recordingAnimation = document.getElementById('recording-animation');
            const recordStatusText = document.getElementById('record-status-text');
            const lyricsInput = document.getElementById('lyrics-input');
            const keywordsInput = document.getElementById('keywords-input');
            const genreSelect = document.getElementById('genre-select');
            const trackUploadInput = document.getElementById('track-upload');
            const transcriptGroup = document.getElementById('transcript-group');
            const transcriptOutput = document.getElementById('transcript-output');


            // --- Audio Recording & Transcription Variables ---
            let mediaRecorder;
            let audioChunks = [];
            let isRecording = false;
            let recordedAudioBlob = null;

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            let recognition;
            let finalTranscript = '';
            let isSpeechRecognitionSupported = !!SpeechRecognition;

            // --- Page Navigation ---
            function showPage(pageId) {
                pages.forEach(page => page.classList.remove('active'));
                const targetPage = document.getElementById(`${pageId}-page`);
                if (targetPage) {
                    targetPage.classList.add('active');
                } else {
                    console.error("Target page not found:", pageId);
                    document.getElementById('home-page').classList.add('active'); // Fallback
                    pageId = 'home';
                }

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-page') === pageId) {
                        link.classList.add('active');
                    }
                });
                window.scrollTo(0, 0);
            }

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    showPage(link.getAttribute('data-page'));
                });
            });

            if (exploreButton) {
                exploreButton.addEventListener('click', () => showPage('feature'));
            }

            backButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    showPage('home');
                });
            });

             // --- Microphone Recording & Transcription Logic ---
             if (recordAudioButton) {
                 recordAudioButton.addEventListener('click', handleRecordButtonClick);
                 if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                     updateRecordStatus('Audio recording not supported.', 'error');
                     recordAudioButton.disabled = true;
                 } else if (!isSpeechRecognitionSupported) {
                     updateRecordStatus('Speech recognition not supported.', 'error');
                     console.warn("Web Speech Recognition API not supported. Recording possible, but no transcription.");
                     // Allow recording button to be enabled
                 }
             } else {
                 console.warn("Record audio button not found.");
             }

            async function handleRecordButtonClick() {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    updateRecordStatus('Recording not supported.', 'error');
                    return;
                }

                if (!isRecording) {
                    // --- START of Recording Logic ---
                    try {
                        recordedAudioBlob = null;
                        trackUploadInput.value = '';
                        transcriptOutput.value = '';
                        finalTranscript = '';
                        transcriptGroup.style.display = 'none';
                        updateRecordStatus('Requesting mic access...', '');

                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        mediaRecorder = new MediaRecorder(stream);

                        // --- Media Recorder Setup ---
                        mediaRecorder.ondataavailable = event => {
                            if (event.data.size > 0) {
                                audioChunks.push(event.data);
                            }
                        };

                        mediaRecorder.onstop = () => {
                            if (audioChunks.length > 0) {
                                recordedAudioBlob = new Blob(audioChunks, { type: 'audio/webm;codecs=opus' });
                                console.log("Recording finished. Blob size:", recordedAudioBlob.size);
                                if (!isSpeechRecognitionSupported || !recognition) {
                                    // Update status only if recognition isn't handling it
                                     updateRecordStatus(`Recording complete (${(recordedAudioBlob.size / 1024).toFixed(1)} KB).`, 'complete');
                                }
                            } else {
                                console.log("Recording stopped with no data.");
                                // Only update status if recognition isn't running or already finished
                                if (!recognition || recognition.readyState !== 'listening') {
                                     updateRecordStatus('Recording stopped (no audio captured).', 'error');
                                }
                                recordedAudioBlob = null;
                            }
                            audioChunks = [];
                            stream.getTracks().forEach(track => track.stop());
                            updateRecordingUI(false); // UI update AFTER state changes
                        };

                        mediaRecorder.onerror = (event) => {
                            console.error("MediaRecorder error:", event.error);
                            updateRecordStatus(`Recording error: ${event.error.name}`, 'error');
                            if (recognition && (recognition.readyState === 'listening' || recognition.readyState === 'pending')) recognition.stop();
                            stream.getTracks().forEach(track => track.stop());
                            updateRecordingUI(false);
                        };

                        // --- Speech Recognition Setup ---
                        if (isSpeechRecognitionSupported) {
                            recognition = new SpeechRecognition();
                            recognition.continuous = true;
                            recognition.interimResults = true;
                            recognition.lang = 'en-US';

                            recognition.onresult = (event) => {
                                let interimTranscript = '';
                                finalTranscript = ''; // Rebuild final transcript
                                for (let i = event.resultIndex; i < event.results.length; ++i) {
                                    if (event.results[i].isFinal) {
                                        finalTranscript += event.results[i][0].transcript + ' '; // Add space between final parts
                                    } else {
                                        interimTranscript += event.results[i][0].transcript;
                                    }
                                }
                                const currentFullTranscript = (finalTranscript + interimTranscript).trim();
                                transcriptOutput.value = currentFullTranscript;
                                if (currentFullTranscript) {
                                     transcriptGroup.style.display = 'block';
                                }
                            };

                            recognition.onerror = (event) => {
                                console.error("Speech Recognition Error:", event.error);
                                let errorMsg = `Transcription error: ${event.error}`;
                                if (event.error === 'no-speech') {
                                    errorMsg = 'No speech detected.';
                                } else if (event.error === 'audio-capture') {
                                     errorMsg = 'Mic problem during transcription.';
                                } else if (event.error === 'not-allowed') {
                                    errorMsg = 'Transcription permission denied.';
                                } else if (event.error === 'network') {
                                    errorMsg = 'Network error during transcription.';
                                }
                                // Update status ONLY if recording is still technically active
                                // Otherwise, let mediaRecorder.onstop handle the final state
                                if (isRecording) {
                                     updateRecordStatus(errorMsg, 'error');
                                }
                            };

                            recognition.onend = () => {
                                console.log("Speech recognition ended.");
                                finalTranscript = finalTranscript.trim(); // Trim final result
                                transcriptOutput.value = finalTranscript;
                                // Determine final status based on whether recording also stopped and if there's a transcript/blob
                                if (!isRecording) { // Check if mediaRecorder also stopped
                                    if(finalTranscript) {
                                        updateRecordStatus('Recording & Transcription Complete.', 'complete');
                                    } else if (recordedAudioBlob) {
                                         updateRecordStatus(`Recording complete. No transcript.`, 'complete');
                                    } else {
                                        // If neither, it was likely an error or stopped with no data
                                        // Status should have been set by error handlers or mediaRecorder.onstop
                                    }
                                }
                                // If isRecording is still true here, recognition likely timed out or stopped early.
                                // The 'recording' animation/status should persist via mediaRecorder.
                            };

                            recognition.start();
                            console.log("Speech recognition started.");
                        }

                        // --- Start Recording ---
                        audioChunks = [];
                        mediaRecorder.start();
                        updateRecordingUI(true);
                        updateRecordStatus('', 'recording'); // Show animation, clear text

                    } catch (err) {
                        console.error("Error accessing microphone or starting recording:", err);
                        updateRecordStatus(`Mic access error: ${err.name}`, 'error');
                        updateRecordingUI(false);
                    }
                } else {
                    // --- Stop Recording & Transcription ---
                   if (mediaRecorder && mediaRecorder.state === "recording") {
                        updateRecordStatus('Stopping...', ''); // Indicate stopping
                        mediaRecorder.stop(); // Triggers onstop
                        if (recognition && (recognition.readyState === 'listening' || recognition.readyState === 'pending')) {
                            recognition.stop(); // Triggers onend
                        }
                        // Final status/UI updates are handled within onstop/onend
                   } else {
                       // Handle edge case where UI is out of sync
                       if (recognition && (recognition.readyState === 'listening' || recognition.readyState === 'pending')) recognition.stop();
                       updateRecordingUI(false);
                       updateRecordStatus('Stopped.', '');
                   }
                }
            }

            function updateRecordingUI(recording) {
                 if (!recordAudioButton) return;
                 isRecording = recording; // Update global state
                 if (recording) {
                     recordAudioButton.textContent = 'Stop Recording';
                     recordAudioButton.classList.remove('btn-warning');
                     recordAudioButton.classList.add('btn-danger');
                 } else {
                     recordAudioButton.textContent = 'Record Audio';
                     recordAudioButton.classList.remove('btn-danger');
                     recordAudioButton.classList.add('btn-warning');
                     // Explicitly hide animation when UI updates to non-recording state
                     if(recordingAnimation) recordingAnimation.style.display = 'none';
                 }
             }

             function updateRecordStatus(message, statusClass = '') {
                if (!recordStatus || !recordStatusText || !recordingAnimation) return;

                recordStatusText.textContent = message;
                recordStatus.className = statusClass; // Apply class for color

                // Show animation and hide text ONLY when class is 'recording'
                if (statusClass === 'recording') {
                    recordingAnimation.style.display = 'inline-block';
                    recordStatusText.textContent = ''; // Clear text while animating
                } else {
                    recordingAnimation.style.display = 'none';
                }
            }

             if(trackUploadInput) {
                 trackUploadInput.addEventListener('change', () => {
                     if (trackUploadInput.files.length > 0) {
                          if (isRecording && mediaRecorder && mediaRecorder.state === "recording") {
                              mediaRecorder.stop();
                              if(recognition && (recognition.readyState === 'listening' || recognition.readyState === 'pending')) recognition.stop();
                          }
                          updateRecordStatus('', ''); // Clear status text & class
                          recordedAudioBlob = null;
                          transcriptOutput.value = '';
                          finalTranscript = '';
                          transcriptGroup.style.display = 'none';
                          updateRecordingUI(false); // Reset button
                     }
                 });
             }


            // --- Feature Page: Get Suggestions Logic ---
            if (getSuggestionsButton) {
                getSuggestionsButton.addEventListener('click', handleGetSuggestions);
            }

            async function handleGetSuggestions() {
                // --- !! EXTREME SECURITY WARNING !! ---
                const GEMINI_API_KEY = "AIzaSyB5c-hp-QeKBpBTz8qwANe4j5Kc4dZ_bWM"; // <-- API Key Inserted
                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`;

                // 1. Get Form Data
                const lyrics = lyricsInput.value.trim();
                const keywords = keywordsInput.value.trim();
                const selectedGenre = genreSelect.value;
                const singingTranscript = transcriptOutput.value.trim();

                // 2. Validation
                if (!lyrics) { displayError("Please provide the song lyrics."); return; }
                if (!keywords) { displayError("Please enter some keywords or describe the theme."); return; }
                if (!selectedGenre) { displayError("Please select a music genre from the list."); return; }

                // 3. UI Update: Clear previous, show loading
                clearResultsAndErrors();
                loadingIndicator.style.display = 'block';
                getSuggestionsButton.disabled = true;
                getSuggestionsButton.textContent = 'Thinking...';

                // 4. Construct Prompt for AI
                let prompt = `
                You are an AI assistant specialized in generating creative concepts for music videos.
                Analyze the following song details:

                **Lyrics:**
                \`\`\`
                ${lyrics}
                \`\`\`
                `;

                if (singingTranscript) {
                    prompt += `
                **Singing Transcript (from recording):**
                (This is a raw transcript of the user singing/speaking. Analyze its emotional tone, rhythm, or key phrases if relevant to supplement the lyrics.)
                \`\`\`
                ${singingTranscript}
                \`\`\`
                `;
                }

                prompt += `
                **Keywords/Theme:** ${keywords}
                **Music Genre:** ${selectedGenre}

                Based on *all* the provided text details (lyrics, keywords, genre, and the singing transcript if available), generate detailed and actionable music video suggestions. Structure your response *exactly* as follows, using markdown headers (##):

                ## Concept / Key Visual
                (Describe the core concept in 1-2 sentences. Then elaborate on the main narrative idea or the central visual motif for the MV in a short paragraph. Be descriptive and evoke a feeling.)

                ## Requirements for MV
                (List key practical requirements using bullet points (\*). Include examples for:
                *   Locations: (e.g., abandoned warehouse, sun-drenched beach, neon-lit city street)
                *   Characters/Actors: (e.g., solo performer, couple, group of friends, specific archetypes)
                *   Key Props: (e.g., vintage car, specific symbolic object, letter)
                *   Visual Style/Effects: (e.g., fast cuts, slow motion, specific color grading like 'desaturated', lens flares, handheld camera feel))

                ## Estimated Budget
                (Provide a conceptual budget breakdown using bullet points (\*). Describe what each level visually enables:)
                *   **High Budget:** [Describe ambitious scope, e.g., multiple complex locations, VFX, large cast/crew, high-end cinematography]
                *   **Mid Budget:** [Describe balanced scope, e.g., fewer locations but well-executed, smaller cast, key visual effects, solid cinematography]
                *   **Low Budget:** [Describe focused scope, e.g., single location or simple concept, performance-focused, creative DIY visuals, relies on strong editing/performance]

                ## Visual Demo (Key Image Descriptions)
                (Describe 3 distinct, vivid visual scenes or key shots *as if describing a photograph*. Start each with '1.', '2.', '3.'. Focus on composition, lighting, subject, action, and mood. DO NOT provide URLs or image data.)
                1.  [Detailed description of Shot 1: e.g., Wide shot, golden hour light filtering through trees, protagonist walking alone on a path...]
                2.  [Detailed description of Shot 2: e.g., Close-up, rain on a windowpane, character's reflection looking melancholic...]
                3.  [Detailed description of Shot 3: e.g., Dynamic shot, low angle view of performer dancing energetically under city lights...]

                ## Moodboard Influences
                (Describe the overall aesthetic mood (e.g., dreamy, gritty, vibrant, melancholic) in one sentence. Then list 4-6 specific visual elements or stylistic references using bullet points (\*). These could be films, art styles, photography types, textures, or general feelings. DO NOT provide URLs or image data.)
                *   [Element 1 Description: e.g., The color palette of Wes Anderson films]
                *   [Element 2 Description: e.g., Grainy texture of old Super 8 footage]
                *   [Element 3 Description: e.g., Dramatic lighting found in film noir]
                *   [Element 4 Description: e.g., Close-up shots focusing on hands and expressions]
                *   [Optional Element 5 Description]
                *   [Optional Element 6 Description]

                ## Color Palette
                (Suggest a primary color palette of 4-5 colors directly relevant to the MV's theme and mood. Provide the color name and its specific HEX code. Format *exactly* like this, separated by commas: Color Name (#XXXXXX), Another Color (#XXXXXX), ...)
                Example: Midnight Blue (#191970), Electric Teal (#00FFFF), Muted Rose (#BC8F8F), Warm Sand (#C19A6B)

                Adhere strictly to this format. Do not add any extra introduction, conclusion, or commentary outside the requested sections.
                `;

                // 5. Prepare API Request Body
                const requestBody = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.75,
                        maxOutputTokens: 3072
                    },
                     safetySettings: [
                       { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                       { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                       { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                       { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                     ]
                };

                // 6. Make API Call
                try {
                    console.log("Sending API request...");
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestBody),
                    });

                    const responseData = await response.json();

                    if (!response.ok) {
                        const errorDetail = responseData?.error?.message || `HTTP Error: ${response.status}`;
                        const safetyFeedback = responseData?.promptFeedback?.blockReason;
                        let errorMessage = `API Error: ${errorDetail}`;
                        if (safetyFeedback) { errorMessage += ` (Reason: ${safetyFeedback})`; }
                        console.error("API Error Details:", responseData);
                        throw new Error(errorMessage);
                    }

                    // 7. Process Successful Response
                    const candidate = responseData?.candidates?.[0];
                    if (candidate?.content?.parts?.[0]?.text) {
                        const generatedText = candidate.content.parts[0].text;
                        parseAndDisplayResults(generatedText);
                    } else if (candidate?.finishReason && candidate.finishReason !== "STOP") {
                         const reason = candidate.finishReason;
                         const safetyRatings = candidate.safetyRatings?.map(r => `${r.category}: ${r.probability}`).join(', ');
                         throw new Error(`Generation failed. Reason: ${reason}. ${safetyRatings ? `Safety Issues: [${safetyRatings}]` : ''}`);
                    } else {
                        // Check for blocked prompt
                        if (responseData?.promptFeedback?.blockReason) {
                             throw new Error(`Request blocked by safety settings. Reason: ${responseData.promptFeedback.blockReason}`);
                        }
                        throw new Error("Received an unexpected or empty response format from the AI.");
                    }

                } catch (error) {
                    console.error("Error during fetch or processing:", error);
                    displayError(`Failed to get suggestions. ${error.message}. Please check the console for more details.`);
                } finally {
                    // 8. UI Update: Hide loading, re-enable button
                    loadingIndicator.style.display = 'none';
                    getSuggestionsButton.disabled = false;
                    getSuggestionsButton.textContent = 'Get Suggestions!';
                }
            }


            // --- Parsing and Displaying Results ---
            function parseAndDisplayResults(text) {
                clearResultsAndErrors();

                const sections = {
                    'Concept / Key Visual': 'result-concept',
                    'Requirements for MV': 'result-requirements',
                    'Estimated Budget': 'result-budget',
                    'Visual Demo (Key Image Descriptions)': 'result-visuals',
                    'Moodboard Influences': 'result-moodboard',
                    'Color Palette': 'result-palette'
                };

                // Pre-process text to handle potential markdown variations
                text = text.replace(/^\s*\*\s*\*\*(High|Mid|Low) Budget\*\*/gm, '* $1 Budget:'); // Bold budget titles

                const lines = text.split('\n');
                let currentSectionKey = null;
                let contentBuffer = '';
                let foundAnySection = false;

                lines.forEach(line => {
                    let matchedHeader = false;
                    for (const title in sections) {
                        const headerRegex = new RegExp(`^\\s*##\\s*${title.trim().replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}\\s*$`, 'i');
                        if (headerRegex.test(line.trim())) {
                            if (currentSectionKey && contentBuffer.trim()) {
                                processSectionContent(sections[currentSectionKey], currentSectionKey, contentBuffer.trim());
                                foundAnySection = true;
                            }
                            currentSectionKey = title;
                            contentBuffer = '';
                            matchedHeader = true;
                            break;
                        }
                    }
                    if (!matchedHeader && currentSectionKey) {
                        contentBuffer += line + '\n';
                    }
                });

                if (currentSectionKey && contentBuffer.trim()) {
                    processSectionContent(sections[currentSectionKey], currentSectionKey, contentBuffer.trim());
                    foundAnySection = true;
                }

                if (foundAnySection) {
                    resultsArea.style.display = 'block';
                    resultsArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    displayError("Could not parse the AI response structure. Raw output logged to console.");
                    console.warn("Raw AI Response Text (Parsing Failed):", text);
                }
            }

            function processSectionContent(elementId, sectionTitle, content) {
                 const sectionElement = document.getElementById(elementId);
                 if (!sectionElement) return;
                 const contentDiv = sectionElement.querySelector('.content');
                 if (!contentDiv) return;

                 contentDiv.innerHTML = ''; // Clear previous

                 try {
                     if (sectionTitle === 'Visual Demo (Key Image Descriptions)') {
                         const descriptions = content.split(/^\s*[1-3]\.\s+/gm).filter(Boolean).map(d => d.trim());
                         const container = contentDiv.classList.contains('image-placeholder-container') ? contentDiv : contentDiv.querySelector('.image-placeholder-container');
                         if(container){
                             container.innerHTML = ''; // Clear specific container
                             if (descriptions.length > 0) {
                                 descriptions.forEach((desc, index) => {
                                     createImagePlaceholder(container, desc, `visual-${index}-${Date.now()}`);
                                 });
                             } else {
                                 container.innerHTML = `<p style="font-style: italic; color: #6c757d;">No specific visual descriptions found in the expected format.</p>`;
                             }
                         }
                     } else if (sectionTitle === 'Moodboard Influences') {
                         const moodboardDescElement = document.getElementById('moodboard-description');
                         const moodboardImagesContainer = document.getElementById('moodboard-images');
                         if (moodboardDescElement && moodboardImagesContainer) {
                             moodboardImagesContainer.innerHTML = ''; // Clear images

                             const bulletPoints = content.split(/^\s*[\*\-]\s+/gm).filter(Boolean).map(b => b.trim());
                             let mainDescription = content.trim();
                             const firstBulletMatch = content.match(/^\s*[\*\-]\s+/m);
                             const firstBulletIndex = firstBulletMatch ? firstBulletMatch.index : -1;

                             if (firstBulletIndex !== -1) {
                                 mainDescription = content.substring(0, firstBulletIndex).trim();
                                 bulletPoints.forEach((desc, index) => {
                                     createImagePlaceholder(moodboardImagesContainer, desc, `mood-${index}-${Date.now()}`);
                                 });
                             } else {
                                // No bullets, treat all as description, no images
                                 mainDescription = content.trim();
                             }

                             moodboardDescElement.textContent = mainDescription;
                             moodboardDescElement.style.display = mainDescription ? 'block' : 'none';
                         } else {
                             contentDiv.textContent = content.trim(); // Fallback
                         }
                     } else if (sectionTitle === 'Color Palette') {
                         const paletteContainer = contentDiv.classList.contains('color-palette-display') ? contentDiv : contentDiv.querySelector('.color-palette-display');
                         if(paletteContainer) createColorSwatches(paletteContainer, content.trim());
                     } else {
                        // Handle text sections with potential bullet points (Requirements, Budget, Concept)
                        let formattedContent = content.trim();
                        // Check if it's a list section
                        if (sectionTitle === 'Requirements for MV' || sectionTitle === 'Estimated Budget') {
                             const listElement = contentDiv.querySelector('ul');
                             if(listElement) {
                                 listElement.innerHTML = ''; // Clear existing list items
                                 const items = formattedContent.split(/^\s*[\*\-]\s+/gm).filter(Boolean).map(item => item.trim());
                                 items.forEach(itemText => {
                                     const li = document.createElement('li');
                                     // Handle bold budget titles specifically
                                     itemText = itemText.replace(/^\*\*(High|Mid|Low) Budget\*\*:\s*/, '<strong>$1 Budget:</strong> ');
                                     li.innerHTML = itemText; // Use innerHTML to render potential <strong> tags
                                     listElement.appendChild(li);
                                 });
                                 contentDiv.innerHTML = ''; // Clear the main div
                                 contentDiv.appendChild(listElement); // Add the list back
                             } else {
                                 // Fallback if <ul> not found (shouldn't happen with HTML structure)
                                 contentDiv.innerHTML = formattedContent.replace(/^\s*[\*\-]\s+/gm, '• ');
                             }
                         } else {
                             // For Concept or other text-only sections without explicit lists expected
                             contentDiv.textContent = formattedContent;
                         }
                     }
                     sectionElement.style.display = 'block';
                 } catch (error) {
                      console.error(`Error processing section "${sectionTitle}":`, error);
                      contentDiv.innerHTML = `<p style="color: red;">Error displaying this section.</p><pre>${content.trim()}</pre>`;
                      sectionElement.style.display = 'block';
                 }
            }


            function createImagePlaceholder(container, description, seedSuffix) {
                 const figure = document.createElement('figure');
                 figure.className = 'image-placeholder';
                 const img = document.createElement('img');
                 const seed = encodeURIComponent(description.substring(0, 20) + seedSuffix); // Slightly longer seed part
                 img.src = `https://picsum.photos/seed/${seed}/400/300`;
                 img.alt = description;
                 img.loading = 'lazy';
                 const figcaption = document.createElement('figcaption');
                 figcaption.textContent = description;
                 figure.appendChild(img);
                 figure.appendChild(figcaption);
                 container.appendChild(figure);
            }

            function createColorSwatches(container, text) {
                 container.innerHTML = ''; // Clear previous
                 const colorRegex = /([\w\s\-\/]+?)\s*\(\s*(#[0-9a-fA-F]{6}|#[0-9a-fA-F]{3})\s*\)/g;
                 let match;
                 let foundColors = false;

                 while ((match = colorRegex.exec(text)) !== null) {
                    foundColors = true;
                    const colorName = match[1].trim().replace(/[\s-]+$/, '');
                    let hexCode = match[2].trim().toUpperCase();
                     if (hexCode.length === 4) {
                         hexCode = '#' + hexCode[1] + hexCode[1] + hexCode[2] + hexCode[2] + hexCode[3] + hexCode[3];
                     }
                    if (hexCode.length !== 7) continue; // Skip invalid

                    const swatch = document.createElement('div');
                    swatch.className = 'color-swatch';
                    try {
                         swatch.style.backgroundColor = hexCode;
                         swatch.style.color = isColorDarkGuess(hexCode) ? '#FFFFFF' : '#000000';
                    } catch (e) {
                        swatch.style.backgroundColor = '#CCCCCC'; swatch.style.color = '#000000';
                    }
                    const nameSpan = document.createElement('span'); nameSpan.textContent = colorName;
                    const hexSpan = document.createElement('span'); hexSpan.className = 'hex-code'; hexSpan.textContent = hexCode;
                    swatch.appendChild(nameSpan); swatch.appendChild(hexSpan);
                    container.appendChild(swatch);
                 }

                 if (!foundColors) {
                     container.innerHTML = `<p style="font-style: italic; color: #6c757d;">Could not parse colors in the expected 'Name (#XXXXXX)' format.</p>`;
                     console.warn("Color parsing failed for text:", text);
                 }
            }

            function isColorDarkGuess(hexColor) {
                 if (!hexColor || !hexColor.startsWith('#')) return false;
                 try {
                     let hex = hexColor.substring(1);
                     if (hex.length === 3) hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2];
                     if (hex.length !== 6) return false;
                     const r = parseInt(hex.substring(0, 2), 16);
                     const g = parseInt(hex.substring(2, 4), 16);
                     const b = parseInt(hex.substring(4, 6), 16);
                     const luminance = (0.2126 * r + 0.7152 * g + 0.0722 * b) / 255;
                     return luminance < 0.5;
                 } catch { return false; }
            }

            function clearResultsAndErrors() {
                const resultSections = resultsArea.querySelectorAll('.result-section');
                resultSections.forEach(section => {
                    section.style.display = 'none';
                    const contentDiv = section.querySelector('.content');
                    if (contentDiv) contentDiv.innerHTML = ''; // Clear all content divs
                    // Ensure specific containers within content divs are also cleared
                     if (section.id === 'result-moodboard') {
                         const descP = section.querySelector('#moodboard-description'); if(descP) descP.textContent = '';
                         const imagesContainer = section.querySelector('#moodboard-images'); if(imagesContainer) imagesContainer.innerHTML = '';
                     }
                      if (section.id === 'result-visuals') {
                          const imagesContainer = section.querySelector('.image-placeholder-container'); if(imagesContainer) imagesContainer.innerHTML = '';
                     }
                      if (section.id === 'result-palette') {
                           const paletteContainer = section.querySelector('.color-palette-display'); if(paletteContainer) paletteContainer.innerHTML = '';
                      }
                      // Ensure lists are cleared for sections that use them
                      if(section.id === 'result-requirements' || section.id === 'result-budget') {
                          const list = section.querySelector('ul'); if(list) list.innerHTML = '';
                      }
                });
                resultsArea.style.display = 'none';
                errorMessageDiv.style.display = 'none';
                errorMessageDiv.textContent = '';
            }

            function displayError(message) {
                errorMessageDiv.textContent = message;
                errorMessageDiv.style.display = 'block';
                resultsArea.style.display = 'none';
                loadingIndicator.style.display = 'none';
            }

            // --- Initial Setup ---
            showPage('home');
        });
    </script>
</body>
</html>
